{"version":3,"sources":["../src/incoming-message.ts"],"names":[],"mappings":"8HAAA;AACA;AACA,kE;;;;;;;AAOO,MAAM,eAAN,SAA8B,cAAK,eAAnC,CAAmD;;;;;AAKxD;AACA,EAAA,WAAW,CAAC,MAAD,EAAS,CAAT,EAAmB,GAAnB,EAAiC;AAC1C,UAAM,MAAN,EAD0C;AAE1C,SAAK,gBAAL,GAAwB,CAAxB;AACA,SAAK,gBAAL,GAAwB,CAAxB;AACA,SAAK,WAAL,GAAmB,KAAnB;AACA;AACA,SAAK,eAAL,GAAuB,KAAvB;AACA;AACA,SAAK,cAAL,GAAsB;AACpB,2BAAqB,IADD,EAAtB;;;AAIA,QAAI,eAAe,GAAG,yBAAE,SAAF,CAAY,CAAC,CAAC,qBAAd,EAAqC,EAArC,CAAtB;AACA,QAAI,KAAK,GAAG,qBAAY,SAAZ,CAAsB,eAAtB,CAAZ;AACA,IAAA,KAAK,GAAG,KAAK,CAAC,MAAN,GAAe,CAAf,GAAoB,IAAG,KAAM,EAA7B,GAAiC,KAAzC;AACA,SAAK,MAAL,GAAc,CAAC,CAAC,UAAhB;AACA,SAAK,GAAL,GAAY,GAAE,CAAC,CAAC,IAAK,GAAE,KAAM,EAA7B;AACA,SAAK,OAAL,GAAe,yBAAE,SAAF,CAAY,CAAC,CAAC,OAAd,CAAf;AACA,SAAK,OAAL,GAAe,yBAAE,OAAF,CAAU,KAAK,OAAf,EAAwB,UAAS,MAAT,EAAiB,GAAjB,EAAsB;AAC3D,aAAO,yBAAE,OAAF,CAAU,GAAV,CAAP;AACD,KAFc,CAAf;AAGA,SAAK,OAAL,CAAa,gBAAb,IAAiC,yBAAE,QAAF,CAAW,yBAAE,SAAF,CAAY,CAAC,CAAC,IAAd,EAAoB,EAApB,EAAwB,MAAnC,CAAjC;AACA;AACA,SAAK,IAAL,GAAY,CAAC,CAAC,eAAF,GAAoB,MAAM,CAAC,IAAP,CAAY,CAAC,CAAC,IAAd,EAAoB,QAApB,CAApB,GAAoD,CAAC,CAAC,IAAlE;AACA,SAAK,GAAL,GAAW,GAAX;AACD,GA/BuD,C;;;AAkC3C,e","file":"incoming-message.js","sourcesContent":["import _ from 'lodash-firecloud';\nimport http from 'http';\nimport querystring from 'querystring';\n\nimport {\n  Context,\n  Event\n} from './types';\n\nexport class IncomingMessage extends http.IncomingMessage {\n  body: string | Buffer;\n\n  ctx: Context;\n\n  // eslint-disable-next-line max-params\n  constructor(socket, e: Event, ctx: Context) {\n    super(socket);\n    this.httpVersionMajor = 1;\n    this.httpVersionMinor = 1;\n    this.httpVersion = '1.1';\n    // @ts-ignore missing typing in http.IncomingMessage\n    this.chunkedEncoding = false;\n    // @ts-ignore missing typing in http.IncomingMessage\n    this._removedHeader = {\n      'transfer-encoding': true\n    };\n\n    let queryParameters = _.defaultTo(e.queryStringParameters, {});\n    let query = querystring.stringify(queryParameters);\n    query = query.length > 0 ? `?${query}` : query;\n    this.method = e.httpMethod;\n    this.url = `${e.path}${query}`;\n    this.headers = _.cloneDeep(e.headers);\n    this.headers = _.mapKeys(this.headers, function(_value, key) {\n      return _.toLower(key);\n    });\n    this.headers['content-length'] = _.toString(_.defaultTo(e.body, '').length);\n    // see https://docs.aws.amazon.com/apigateway/latest/developerguide/set-up-lambda-proxy-integrations.html\n    this.body = e.isBase64Encoded ? Buffer.from(e.body, 'base64') : e.body;\n    this.ctx = ctx;\n  }\n}\n\nexport default IncomingMessage;\n"]}